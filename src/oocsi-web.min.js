var OOCSI=(function(){var c="ws://localhost:9000/";var e;var l={};var o;var q=false;var r=b;function m(){r("CONNECTING to "+c);o=new WebSocket(c);o.onopen=function(s){f(s)};o.onclose=function(s){d(s)};o.onmessage=function(s){n(s)};o.onerror=function(s){g(s)}}function f(s){if(o.readyState==WebSocket.OPEN){i(e);q=true}r("CONNECTED")}function d(s){r("DISCONNECTED");q=false}function n(s){o.send(".");if(s.data!="ping"){try{var t=JSON.parse(s.data);if(l[t.recipient]!==undefined){l[t.recipient](t)}else{r("no handler for event: "+s.data)}}catch(t){r("ERROR: parse exception for event data "+s.data)}}r("RESPONSE: "+s.data)}function g(s){r("ERROR: "+s.data)}function j(s){if(!o||o.readyState==WebSocket.CONNECTING){setTimeout(function(){j(s)},200)}else{s()}}function k(){o&&o.close()}function i(s){if(o&&o.send(s)){r("SENT: "+s)}}function b(s){}function a(s,t){q&&i("sendjson "+s+" "+JSON.stringify(t))}function h(t,s){if(q){i("subscribe "+t);l[t]=s}}function p(s){if(q){i("unsubscribe "+s);l[s]=function(){}}}return{connect:function(u,t,s){c=u;e=t&&t.length>0?t:"webclient_"+ +(new Date());l[t]=s;m()},send:function(t,s){j(function(){a(t,s)})},subscribe:function(t,s){j(function(){h(t,s)})},unsubscribe:function(s){j(function(){p(s)})},isConnected:function(){return q},close:function(){j(function(){k()})},handlers:function(){return l},logger:function(s){r=s}}})();

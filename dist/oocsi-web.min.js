var OOCSI=(function(){var c="ws://localhost:9000/";var e;var n={};var j={};var r;var t=false;var u=b;function p(){u("CONNECTING to "+c);r=new WebSocket(c);r.onopen=function(v){f(v)};r.onclose=function(v){d(v)};r.onmessage=function(v){q(v)};r.onerror=function(v){g(v)}}function f(v){if(r.readyState==WebSocket.OPEN){i(e);t=true}u("CONNECTED")}function d(v){u("DISCONNECTED");t=false}function q(v){r.send(".");if(v.data!="ping"){try{var w=JSON.parse(v.data);if(w.data.hasOwnProperty("_MESSAGE_ID")&&j.hasOwnProperty(w.data._MESSAGE_ID)){var x=j[w.data._MESSAGE_ID];if((+new Date)<x.expiration){delete w.data._MESSAGE_ID;x.fn(w.data)}delete j[w.data._MESSAGE_ID]}else{if(n[w.recipient]!==undefined){n[w.recipient](w)}else{u("no handler for event: "+v.data)}}}catch(w){u("ERROR: parse exception for event data "+v.data)}u("RESPONSE: "+v.data)}}function g(v){u("ERROR: "+v.data)}function l(v){if(!r||r.readyState==WebSocket.CONNECTING){setTimeout(function(){l(v)},200)}else{v()}}function m(){r&&r.close()}function i(v){if(r&&r.send(v)){u("SENT: "+v)}}function b(v){}function a(v,w){t&&i("sendjson "+v+" "+JSON.stringify(w))}function k(x,z,y,w){if(t){var v=o();j[v]={expiration:(+new Date)+y,fn:w};z._MESSAGE_ID=v;z._MESSAGE_HANDLE=x;i("sendjson "+x+" "+JSON.stringify(z))}}function h(w,v){if(t){i("subscribe "+w);n[w]=v}}function s(v){if(t){i("unsubscribe "+v);n[v]=function(){}}}function o(){function v(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return v()+v()+"-"+v()+"-"+v()+"-"+v()+"-"+v()+v()+v()}return{connect:function(x,w,v){c=x;e=w&&w.length>0?w:"webclient_"+ +(new Date());n[w]=v;p()},send:function(w,v){l(function(){a(w,v)})},call:function(w,y,x,v){l(function(){k(w,y,x,v)})},subscribe:function(w,v){l(function(){h(w,v)})},unsubscribe:function(v){l(function(){s(v)})},isConnected:function(){return t},close:function(){l(function(){m()})},handlers:function(){return n},logger:function(v){u=v}}})();
